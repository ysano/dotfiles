# 移行アシスタント

GitHub環境間でのプロジェクト移行、リポジトリ統合、チーム再編成を支援する包括的な移行ツール。Issues、Projects、Discussions、リポジトリ設定の安全で完全な移行を保証します。

## 手順

1. **前提条件の確認**
   - GitHub CLI（`gh`）がインストールされ認証済みであることを確認
   - GitHub API接続とトークン権限を確認
   - ソースとターゲットリポジトリの管理権限を確認
   - バックアップストレージが利用可能であることを確認

2. **移行パラメータの解析**
   - 以下からアクションとオプションを抽出: **$ARGUMENTS**
   - 有効なアクション: plan, analyze, migrate, verify, rollback
   - ソースとターゲットリポジトリを決定
   - 移行範囲とフィルタを設定

3. **移行環境の初期化**
   - 移行ワークスペースディレクトリを作成
   - ログ記録と監査証跡を設定
   - チェックポイントシステムを初期化
   - ロールバック機構を準備

4. **移行アクションの実行**
   選択されたアクションに基づいて:

   ### Plan アクション
   - ソースシステム構造の分析
   - システム間のフィールドマッピング
   - 潜在的な競合の特定
   - 移行戦略の生成
   - 時間とリソースの見積もり
   - 詳細な移行計画の作成

   ### Analyze アクション
   - 移行するアイテムの数をカウント
   - データ互換性の確認
   - カスタムフィールドの特定
   - 添付ファイルサイズの評価
   - 移行影響の計算
   - 移行前レポートの生成

   ### Migrate アクション
   - ソースデータの完全バックアップを作成
   - バッチ単位での移行実行
   - 形式間でのデータ変換
   - 関係性の保持
   - 添付ファイルとメディアの処理
   - 進捗チェックポイントの作成
   - 全操作のログ記録

   ### Verify アクション
   - ソースとターゲットデータの比較
   - 全アイテムが移行されたことを検証
   - 関係性の整合性チェック
   - カスタムフィールドマッピングの検証
   - 相互参照のテスト
   - 検証レポートの生成

   ### Rollback アクション
   - ロールバックチェックポイントの読み込み
   - 元の状態の復元
   - 部分的な移行のクリーンアップ
   - ロールバック完了の検証
   - ロールバックレポートの生成

## 使用方法
```bash
migration-assistant [action] [options]
```

## アクション
- `plan` - 移行プランの作成
- `analyze` - 移行範囲の評価
- `migrate` - 移行の実行
- `verify` - 移行結果の検証
- `rollback` - 移行のロールバック

## オプション
- `--source <repo>` - ソースリポジトリ（owner/repo）
- `--target <repo>` - ターゲットリポジトリ（owner/repo）
- `--scope <items>` - 移行するアイテム（all/issues/prs/projects/discussions/releases）
- `--dry-run` - 移行のシミュレーション
- `--parallel <n>` - 並列処理スレッド数
- `--checkpoint` - チェックポイント回復を有効化
- `--mapping-file <path>` - カスタムフィールドマッピング
- `--preserve-ids` - 参照IDの維持
- `--archive-source` - 移行後のアーカイブ

## 例
```bash
# リポジトリ移行の計画
migration-assistant plan --source owner/old-repo --target owner/new-repo

# 移行範囲の分析
migration-assistant analyze --scope all --source owner/repo

# ドライラン移行
migration-assistant migrate --dry-run --parallel 4

# チェックポイント付きで移行実行
migration-assistant migrate --checkpoint --backup

# 移行完了の検証
migration-assistant verify --deep-check

# 必要時のロールバック
migration-assistant rollback --transaction-id 12345
```

## 移行フェーズ

### 1. 計画フェーズ
- ソースデータのインベントリ
- データ構造のマッピング
- 非互換性の特定
- 移行時間の見積もり
- 移行計画の生成

### 2. 準備フェーズ
- 完全バックアップの作成
- 権限の検証
- ターゲット構造の設定
- マッピングの設定
- 接続性のテスト

### 3. 移行フェーズ
- バッチ単位でのデータ転送
- 関係性の維持
- メタデータの保持
- 添付ファイルの処理
- 参照の更新

### 4. 検証フェーズ
- レコード数の比較
- データ整合性の検証
- 関係性のチェック
- 添付ファイルの検証
- 機能のテスト

### 5. 最終化フェーズ
- ドキュメントの更新
- Webhookのリダイレクト
- ソースデータのアーカイブ
- レポートの生成
- ユーザーの訓練

## データマッピング設定
```yaml
mappings:
  github_to_github:
    issue:
      title: title
      body: body
      state: state
      labels: labels
      milestone: milestone
      assignees: assignees
    
    project:
      name: name
      description: description
      columns: columns
      cards: items
      
    custom_fields:
      - source: "project.status"
        target: "project_v2.status"
        transform: "map_status"
      
    relationships:
      - type: "issue-project"
        source: "project_card"
        target: "project_item"
```

## 移行安全機能

### 移行前チェック
- ストレージ容量の検証
- APIレート制限の評価
- 権限の検証
- 依存関係のチェック
- 競合の検出

### 移行中
- トランザクションログ記録
- 進捗追跡
- エラー回復
- チェックポイント作成
- パフォーマンス監視

### 移行後
- データ検証
- 整合性チェック
- パフォーマンステスト
- ユーザー受け入れ
- ロールバック準備

## チェックポイント回復
```json
{
  "checkpoint": {
    "id": "mig-20240120-1430",
    "progress": {
      "total_items": 5000,
      "completed": 3750,
      "failed": 12,
      "pending": 1238
    },
    "state": {
      "last_processed_id": "issue-3750",
      "batch_number": 75,
      "error_count": 12
    }
  }
}
```

## ロールバック機能
- ポイントインタイム回復
- 選択的ロールバック
- 関係性の保持
- 監査証跡の維持
- データ損失ゼロ保証

## パフォーマンス最適化
- バッチ処理
- 並列転送
- API呼び出し最適化
- キャッシュ戦略
- リソース監視

## 移行レポート
- エグゼクティブサマリー
- 詳細なアイテムマッピング
- エラー分析
- パフォーマンスメトリクス
- 推奨事項リスト

## 一般的な移行シナリオ

### リポジトリ統合
1. 複数のリポジトリを1つに統合
2. Issueを結合し参照を保持
3. プロジェクトボードとワークフローを統合
4. ドキュメントとWikiを統合
5. チーム権限と設定を統一

### リポジトリ分割
1. 特定のコンポーネントを新しいリポジトリに抽出
2. ラベルやコンポーネントでIssueをフィルタ
3. 機能領域でプロジェクトボードを分割
4. 関連ファイルのコミット履歴を保持
5. 相互参照とリンクを更新

### 組織移行
1. 組織間でリポジトリを移動
2. チームメンバーシップと権限を転送
3. 組織レベルのプロジェクトを移行
4. WebhookとIntegrationを更新
5. コラボレーション履歴を保持

## 必要な依存関係
- 適切な認証を行ったGitHub CLI（gh）
- リポジトリアクセス権限を持つGit
- 適切なスコープを持つGitHub APIトークン

## エラーハンドリング
- バックオフ付き自動リトライ
- 詳細なエラーログ記録
- 部分的な失敗回復
- 手動介入ポイント
- 包括的なエラーレポート

## ベストプラクティス
- 常に最初に分析を実行
- テストにはドライランを使用
- 大規模データセットは段階的に移行
- チームとのコミュニケーションを維持
- 検証完了まではソースデータを保持
- カスタムマッピングを文書化
- ロールバック手順をテスト

## コンプライアンスと監査
- 完全な監査証跡
- データ保持コンプライアンス
- プライバシー保護
- 変更認可
- 移行認証

## 注記
このコマンドは、バックアップ、ログ、ドキュメントを含む完全なGitHub移行パッケージを作成します。中断が発生した場合、チェックポイントから移行を再開できます。すべての移行は、GitHubの組み込み機能を使用して保持期間内で元に戻すことができます。