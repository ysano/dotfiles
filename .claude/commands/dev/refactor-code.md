# コードリファクタリングコマンド

機能を保持しながら保守性、パフォーマンス、可読性を向上させるために安全にコードをリファクタリングします。

## 実行手順

コードをリファクタリングするための体系的なアプローチに従う: **$ARGUMENTS**

1. **リファクタリング前分析**
   - リファクタリングが必要なコードとその理由を特定
   - 現在の機能と動作を完全に理解
   - 既存のテストとドキュメントの確認
   - すべての依存関係と使用ポイントの特定

2. **テストカバレッジ検証**
   - リファクタリング対象コードに包括的なテストカバレッジが存在することを確認
   - テストが不足している場合は、リファクタリング開始前に作成
   - すべてのテストを実行してベースラインを確立
   - 必要に応じて追加テストで現在の動作を文書化

3. **リファクタリング戦略**
   - リファクタリングの明確な目標を定義（パフォーマンス、可読性、保守性）
   - 適切なリファクタリング技法を選択:
     - メソッド/関数の抽出
     - クラス/コンポーネントの抽出
     - 変数/メソッドの名前変更
     - メソッド/フィールドの移動
     - ポリモーフィズムによる条件分岐の置換
     - デッドコードの除去
   - 小さな増分ステップでリファクタリングを計画

4. **環境セットアップ**
   - 新しいブランチを作成: `git checkout -b refactor/$ARGUMENTS`
   - 開始前にすべてのテストが成功することを確認
   - 必要な追加ツール（プロファイラー、アナライザー）をセットアップ

5. **段階的リファクタリング**
   - 一度に小さく焦点を絞った変更を実施
   - 各変更後にテストを実行して何も壊れていないことを確認
   - 動作する変更を説明的なメッセージで頻繁にコミット
   - 安全性のため利用可能な場合はIDEリファクタリングツールを使用

6. **コード品質改善**
   - 明確性のための命名規則を改善
   - コードの重複を排除（DRY原則）
   - 複雑な条件ロジックを簡素化
   - メソッド/関数の長さと複雑さを削減
   - 関心の分離を改善

7. **パフォーマンス最適化**
   - パフォーマンスのボトルネックを特定し排除
   - アルゴリズムとデータ構造を最適化
   - 不要な計算を削減
   - メモリ使用パターンを改善

8. **デザインパターンの適用**
   - 有益な場合に適切なデザインパターンを適用
   - 抽象化とカプセル化を改善
   - モジュール性と再利用性を向上
   - コンポーネント間の結合を削減

9. **エラーハンドリング改善**
   - エラーハンドリングアプローチを標準化
   - エラーメッセージとログを改善
   - 適切な例外処理を追加
   - 回復力と耐障害性を向上

10. **ドキュメント更新**
    - 変更を反映するためコードコメントを更新
    - インターフェースが変更された場合はAPIドキュメントを改訂
    - インラインドキュメントと例を更新
    - コメントが正確で有用であることを確認

11. **テスト強化**
    - 作成された新しいコードパスのテストを追加
    - 既存テストの品質とカバレッジを改善
    - 古いテストを削除または更新
    - テストが依然として意味があり効果的であることを確認

12. **静的解析**
    - スタイルと潜在的な問題を捉えるためのリンティングツールを実行
    - 問題を特定するため静的解析ツールを使用
    - セキュリティ脆弱性をチェック
    - コード複雑度メトリクスを検証

13. **パフォーマンス検証**
    - 該当する場合はパフォーマンスベンチマークを実行
    - 変更前後のメトリクスを比較
    - リファクタリングがパフォーマンスを劣化させていないことを確認
    - パフォーマンス改善を文書化

14. **統合テスト**
    - 回帰がないことを確認するため完全なテストスイートを実行
    - 依存システムとの統合をテスト
    - すべての機能が期待通りに動作することを検証
    - エッジケースとエラーシナリオをテスト

15. **コードレビュー準備**
    - 品質と一貫性について全変更をレビュー
    - リファクタリング目標が達成されたことを確認
    - 実施した変更の明確な説明を準備
    - 利益と理論的根拠を文書化

16. **変更の文書化**
    - リファクタリング変更の要約を作成
    - 破壊的変更や新しいパターンを文書化
    - 必要に応じてプロジェクトドキュメントを更新
    - 将来の参考のため利益と理由を説明

17. **デプロイメント考慮事項**
    - リファクタリングされたコードのデプロイメント戦略を計画
    - 段階的ロールアウトのためのフィーチャーフラグを検討
    - ロールバック手順を準備
    - リファクタリングされたコンポーネントの監視を設定

重要: リファクタリングは内部構造を改善しながら外部動作を保持する必要がある。常に速度よりも安全性を優先し、プロセス全体を通じて包括的なテストカバレッジを維持する。