# Test Coverage Analysis and Improvement

テストカバレッジを分析・改善する体系的手順。

## 1. カバレッジツールセットアップ

適切なカバレッジツールを特定・設定:
- **JavaScript/Node.js**: Jest, NYC, Istanbul
- **Python**: Coverage.py, pytest-cov
- **Java**: JaCoCo, Cobertura
- **C#**: dotCover, OpenCover
- **Ruby**: SimpleCov

カバレッジレポート形式 (HTML, XML, JSON) と品質ゲートの閾値を設定。

## 2. ベースラインカバレッジ分析

- 既存テストをカバレッジレポート付きで実行
- 包括的なカバレッジレポートを生成
- 現在のカバレッジ率を文書化:
  - Line coverage (行カバレッジ)
  - Branch coverage (分岐カバレッジ)
  - Function coverage (関数カバレッジ)
  - Statement coverage (文カバレッジ)
- 未カバーコード領域を特定

## 3. カバレッジレポート分析

- ファイル・ディレクトリ別の詳細カバレッジレポートを確認
- 重要な未カバーコードパスを特定
- 条件ロジックの分岐カバレッジを分析
- 未テストの関数・メソッドを発見
- 時系列のカバレッジトレンドを調査

## 4. クリティカルパス特定

- カバレッジが不足するビジネスクリティカルなコードを特定
- 高リスク・低カバレッジ領域を優先順位付け
- パブリック API とインターフェースに集中
- エラーハンドリングとエッジケースを対象化
- セキュリティセンシティブなコードパスを調査

## 5. テストギャップ分析

未カバーコードを分類:
- 即座にテストが必要なビジネスロジック
- エラーハンドリングと例外パス
- 設定とセットアップコード
- ユーティリティ関数とヘルパー
- 削除すべきデッドコードまたは廃止コード

## 6. 戦略的テスト作成

- 未カバーのビジネスロジックにユニットテストを記述
- 未カバーのワークフローに統合テストを追加
- エラー条件とエッジケースのテストを作成
- 設定と環境固有コードをテスト
- バグが発生しやすい領域にリグレッションテストを追加

## 7. 分岐カバレッジの改善

- 未カバーの条件分岐を特定
- true / false 両方の条件をテスト
- すべての switch / case 文をカバー
- 例外ハンドリングパスをテスト
- ループ条件と反復を検証

## 8. エッジケーステスト

- 境界条件と制限をテスト
- null, 空, 無効な入力をテスト
- タイムアウトとネットワーク障害シナリオをテスト
- リソース枯渇条件をテスト
- 並行アクセスと競合状態をテスト

## 9. カバレッジ品質評価

- テストが実際に動作を検証していることを確認 (単なる実行ではない)
- テスト内の有意義なアサーションを確認
- 実装詳細のテストを避ける
- 契約とインターフェースのテストに集中
- カバレッジメトリクスと並行してテスト品質をレビュー

## 10. チェックリスト

- [ ] カバレッジツールをセットアップ
- [ ] ベースラインカバレッジを計測
- [ ] クリティカルパスと未カバー領域を特定
- [ ] 優先順位付けされたテストギャップを分析
- [ ] 戦略的にテストを追加
- [ ] 分岐カバレッジとエッジケースをカバー
- [ ] テストの品質を評価 (単なるカバレッジではない)
- [ ] CI/CD でカバレッジ監視を設定

関連リファレンス: `write-tests.md`, `mutation-testing.md`, `comprehensive-testing.md`
