# Write Unit and Integration Tests

ユニット・統合テストを体系的に作成する手順。

## 1. テストフレームワーク検出

- 使用中のテストフレームワークを特定 (Jest, Mocha, PyTest, RSpec 等)
- 既存のテスト構造と命名規則を確認
- テスト設定ファイルとセットアップを確認
- プロジェクト固有のテストパターンを理解

## 2. テスト対象コードの分析

- テストが必要なコードを分析
- パブリックインターフェースと重要なビジネスロジックを特定
- 依存関係と外部連携をマッピング
- エラー条件とエッジケースを理解

## 3. テスト戦略の計画

必要なテストレベルを決定:
- **ユニットテスト**: 個別の関数・メソッド
- **統合テスト**: コンポーネント間の連携
- **E2E テスト**: ユーザーワークフロー

カバレッジ目標と優先度を計画し、モック・スタブ要件を特定。

## 4. ユニットテスト実装

- 個別の関数・メソッドを分離してテスト
- ハッピーパスを最優先でカバー
- エッジケースと境界条件をテスト
- エラー条件と例外ハンドリングをテスト
- 適切なアサーションと期待値を使用

## 5. テスト構造と組織化

- **AAA パターン** (Arrange, Act, Assert) に従う
- シナリオを説明する記述的なテスト名を使用
- 関連テストを test suites / describe ブロックでグループ化
- テストを集中的かつアトミックに保つ

## 6. モッキングとスタブ

- 外部依存関係とサービスをモック
- ユニットテストの複雑な操作をスタブ
- 信頼性の高いテストのための適切な分離を使用
- テストを脆弱にする過剰なモックを避ける

## 7. データセットアップとクリーンアップ

- テストフィクスチャとサンプルデータを作成
- テスト環境をクリーンにセットアップ・クリーンアップ
- 複雑なテストデータにファクトリーやビルダーを使用
- テストが互いに干渉しないことを保証

## 8. 統合テストの記述

- コンポーネント間の連携とデータフローをテスト
- 様々なシナリオで API エンドポイントをテスト
- データベース操作とトランザクションをテスト
- 外部サービス統合をテスト

## 9. エラーと例外のテスト

- すべてのエラー条件と例外パスをテスト
- 適切なエラーメッセージとコードを検証
- エラー回復とフォールバックメカニズムをテスト
- バリデーションとセキュリティシナリオをテスト

## 10. チェックリスト

- [ ] テストフレームワークと規則を確認
- [ ] 対象コードと依存関係を分析
- [ ] AAA パターンでテストを構造化
- [ ] ハッピーパス・エッジケース・エラーをカバー
- [ ] 外部依存をモック
- [ ] テストの分離と独立性を確保
- [ ] 記述的なテスト名を使用
- [ ] テストの実行成功を確認

関連リファレンス: `test-coverage.md`, `generate-test-cases.md`, `e2e-setup.md`
