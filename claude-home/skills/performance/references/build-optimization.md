# ビルド最適化手順

ビルドプロセスとビルド速度を以下の手順で最適化する。

## 1. ビルドシステム分析

- ビルドシステムを特定 (Webpack, Vite, Rollup, Gradle, Maven, Cargo 等)
- ビルド設定ファイルと設定をレビュー
- 現在のビルド時間と出力サイズを分析
- ビルドパイプラインと依存関係をマッピング

## 2. パフォーマンスベースライン

以下のシナリオでビルド時間を計測:

- クリーンビルド (キャッシュなし)
- インクリメンタルビルド (キャッシュあり)
- 開発 vs 本番ビルド

バンドルサイズとアセットサイズを文書化し、最も遅い部分を特定。

## 3. 依存関係の最適化

- ビルド依存関係とその影響を分析
- ビルドプロセスから未使用の依存関係を除去
- ビルドツールを最新安定版に更新
- より高速なビルドツールへの移行を検討

## 4. キャッシュ戦略

- ビルドキャッシュを有効化・最適化
- CI/CD 用の永続キャッシュを設定
- チーム開発用の共有キャッシュを設定
- インクリメンタルコンパイルを可能な限り実装

## 5. バンドル分析

バンドルサイズの詳細は `bundle-optimization.md` を参照。

- バンドル構成とサイズを分析
- 大きな依存関係と重複を特定
- ビルドツール固有のバンドルアナライザーを使用

## 6. コード分割・遅延読み込み

- 動的インポートとコード分割を実装
- SPA 用のルートベース分割を設定
- ベンダーチャンク分離を設定
- チャンクサイズと読み込み戦略を最適化

## 7. アセット最適化

- 画像圧縮、フォーマット変換、遅延読み込み
- CSS / JavaScript の minification
- ツリーシェイキングによるデッドコード除去
- アセット圧縮 (gzip, brotli)

## 8. 開発ビルド最適化

- Fast Refresh / HMR を有効化
- 開発専用の最適化を使用
- デバッグ用ソースマップを設定
- 開発サーバー設定を最適化

## 9. 本番ビルド最適化

- 全本番最適化を有効化
- デッドコード除去を設定
- 適切な minification と圧縮を設定

## 10. 並列処理

- サポートされている場合は並列処理を有効化
- ビルドタスク用ワーカースレッドを設定
- マルチコアシステム用に最適化
- TypeScript/Babel の並列コンパイルを使用

## 11. ツール固有の最適化

- **Webpack**: optimization.splitChunks, thread-loader, usedExports
- **Vite**: build.rollupOptions, esbuild, 依存関係プリバンドル
- **TypeScript**: incremental compilation, project references, skipLibCheck

## 12. CI/CD ビルド最適化

- CI ビルド環境とリソースを最適化
- CI 用の適切なキャッシュ戦略を実装
- ビルドマトリクスを効率的に使用
- 並列 CI ジョブを設定

## 13. 監視・メンテナンス

- ビルド時間の監視を設定
- バンドルサイズの変更を追跡
- ビルドパフォーマンス回帰を監視
- 最適化の変更とその効果を文書化

See also: バンドルサイズは `bundle-optimization.md`、CI/CD は `monitoring.md` を参照。
