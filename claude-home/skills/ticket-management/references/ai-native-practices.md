AI-Native Practices: AI Agent を含むチームの DoD、カスタムフィールド、品質メトリクス。

## AI-Native DoD（Definition of Done）

従来の手動チェックリストを、Hooks 強制と自動検証に置き換える。

### AI Implementation 完了条件

AI Agent が PR 作成する前に満たすべき条件:

- [ ] コードが動作する（ビルドエラーなし）
- [ ] 変更に対応するテストを追加済み
- [ ] 既存テストが全パス
- [ ] lint / formatter エラーなし
- [ ] 変更ファイルに対応する docs/ の更新済み（該当する場合）
- [ ] PR 説明に Atomic Spec 5 要素との対応を記述

### Human Review 完了条件

ARE（AI Review Engineer）がマージ前に確認すべき条件:

- [ ] ロジックの正しさ（AI ハルシネーションがないか）
- [ ] エッジケースの網羅性
- [ ] セキュリティ上の問題がないか
- [ ] パフォーマンスへの影響
- [ ] 既存コードとの一貫性
- [ ] AI-Confidence が 80 以上（80 未満は重点レビュー）

### Hooks 強制

コミット時に自動検証を実行し、DoD 違反を防止する:

| Hook | 検証内容 | 失敗時 |
|---|---|---|
| pre-commit | lint / formatter / 型チェック | コミット拒否 |
| pre-commit | 変更ファイルに対応するテストファイルの存在 | 警告表示 |
| pre-push | 全テスト実行 | プッシュ拒否 |
| commit-msg | Conventional Commits 形式の検証 | コミット拒否 |

### DoD レベル

| レベル | 対象 | 含める項目 |
|---|---|---|
| **最小** | 個人開発・Spike | AI Implementation 完了条件のみ |
| **標準** | チーム開発 | AI Implementation + Human Review 完了条件 |
| **厳格** | プロダクション・規制対応 | 標準 + セキュリティレビュー + ステージング検証 |

## AI-Native カスタムフィールド

AI Agent を含むチームで追跡すべきフィールド:

### AI-Confidence (0-100)

AI Agent が自身の実装に対する確信度を自己申告する。

| 範囲 | 意味 | アクション |
|---|---|---|
| 90-100 | 高確信。明確な仕様、十分なテスト | 通常レビュー |
| 80-89 | 標準。一部に判断が必要な箇所あり | 通常レビュー |
| 60-79 | 低確信。仕様の曖昧さ or 複雑なロジック | 重点レビュー必須 |
| 0-59 | 非常に低い。推測に基づく実装あり | Spec Definition に差し戻し検討 |

### Turns-Used

AI Agent が実装に要したプロンプト往復回数。

| 回数 | 判定 | アクション |
|---|---|---|
| 1-3 | 優秀 | Spec の品質が高い（Churn 3 回ルール内） |
| 4-6 | 注意 | Spec に曖昧さがある可能性。曖昧箇所を特定・補足 |
| 7-10 | 異常 | Spec Definition に差し戻し。5 要素を再記述 |
| 10 超 | 粒度超過 | チケット分割を検討 |

### Review-Priority

Human Review の優先度を AI が自動判定する。

| 優先度 | 基準 | レビュー方針 |
|---|---|---|
| **High** | セキュリティ関連、認証・認可、決済処理 | セキュリティ専門レビュアー必須 |
| **Medium** | ビジネスロジック、データ変換、API 設計 | ARE による通常レビュー |
| **Low** | スタイル変更、ドキュメント更新、設定変更 | 軽量レビュー or 自動承認 |

## 品質メトリクス

### MTTV（Mean Time To Value）

PR 作成から人間承認（マージ）までの時間。

- **目標**: 1 時間以内（標準的な Atomic Spec サイズ）
- **計測方法**: PR 作成タイムスタンプ → マージタイムスタンプの差分
- **異常値**: 4 時間超 → レビュープロセスのボトルネックを調査

### Interaction Churn

1 つのチケットに対するプロンプト往復回数。仕様の品質を反映する。

- **目標**: 3 回以内
- **3 回超**: 仕様の曖昧さを検知。Spec Definition を改善
- **計測方法**: AI Agent のターン数を Turns-Used フィールドに記録

### AI-Generated Code Coverage

AI 生成コードの割合と障害率の相関を追跡する。

- **追跡項目**: AI 生成 PR 数 / 全 PR 数、AI 生成 PR の障害率 / 全体障害率
- **目的**: AI Agent の品質が人間開発者と同等以上であることを定量的に確認
- **異常値**: AI 生成コードの障害率が全体の 1.5 倍超 → プロンプト・Spec の品質改善

## AI Janitor 運用詳細

自動化された鮮度管理ルール。人間の定例会議を AI の自動検証で置き換える。

### Stale Ticket 再現検証

Backlog に 7 日以上放置された Bug チケットの自動処理:

1. AI Agent がチケットの再現手順を読み取る
2. 現在の環境で再現テストを実行
3. **再現成功**: Priority を再評価し、Spec Definition に遷移
4. **再現失敗**: `[AI Janitor] 再現不可` コメントを付与 → クローズ候補としてマーク

### 4 時間ルール対処フロー

AI Implementation が 4 時間を超過した場合:

1. AI Agent の作業を中断
2. チケットを Spec Definition に差し戻し
3. `[AI Janitor] 4時間超過` コメントを付与
4. 原因分析: Spec の粒度超過 or Constraints 不足 or 技術的ブロッカー
5. チケット分割 or Spec 補足を実施

### Churn 検知フロー

プロンプト往復が 3 回を超えた場合:

1. AI Agent が `[Churn Alert]` を通知
2. 人間が Spec の 5 要素を再確認
3. 曖昧な要素を特定・補足
4. 必要に応じてチケットを Spec Definition に差し戻し
