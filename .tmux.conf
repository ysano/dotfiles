# Modern tmux Configuration v2.0
# リファクタリング版: 変数管理とモジュラー設計

# === 環境変数による動的設定 ===
# 設定の柔軟性を環境変数で提供

# === 基本設定モジュール ===
source-file ~/.tmux/base.conf
source-file ~/.tmux/terminal.conf

# === 外観とステータス ===
source-file ~/.tmux/appearance.conf
source-file ~/.tmux/status.conf

# === キーバインド ===
source-file ~/.tmux/keybindings.conf

# === OS固有設定（改善された検出） ===
# Pure Linux環境
if-shell 'test "$(uname)" = "Linux" && test -z "$WSL_DISTRO_NAME" && ! grep -qi microsoft /proc/version 2>/dev/null' \
  'source-file ~/.tmux/os/linux.conf'

# macOS環境
if-shell 'test "$(uname)" = "Darwin"' \
  'source-file ~/.tmux/os/darwin.conf'

# FreeBSD環境
if-shell 'test "$(uname)" = "FreeBSD"' \
  'source-file ~/.tmux/os/freebsd.conf'

# === 統合機能 ===
# 必要に応じて統合機能を追加

# === Claude Voice統合（条件付き） ===
if-shell '[ "${CLAUDE_VOICE_ENABLED:-true}" = "true" ] && [ -f ~/.tmux/claude.conf ]' \
  'source-file ~/.tmux/claude.conf'

# === パフォーマンス設定 ===
# 必要に応じてパフォーマンス設定を追加

# === デバッグモード設定 ===
if-shell '[ "${TMUX_DEBUG_MODE:-false}" = "true" ]' \
  'display-message "tmux v2.0 configuration loaded with debug mode"'

# === バージョン互換性チェック ===
if-shell 'tmux -V | cut -d" " -f2 | awk "BEGIN{FS=\".\"} {exit !(\$1 < 2 || (\$1 == 2 && \$2 < 9))}"' \
  'display-message "Warning: tmux version may be too old. Minimum required: 2.9"'

# === プラグイン統合 ===
source-file ~/.tmux/plugin-config/resurrect.conf
run '~/.tmux/plugins/tpm/tpm'