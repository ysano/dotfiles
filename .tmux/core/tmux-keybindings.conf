# TMux Keybindings - Phase 2 Unified System
# 統合キーバインド設定

# ====================================
# Audio Mode Switcher (Prefix + C-n)
# ====================================

# Prefix + C-n: Audio mode cycle (音声デバイス ↔ システム通知)
bind-key C-n run-shell "/home/user/dotfiles/.tmux/core/audio-mode-switcher.sh tmux-cycle"

# Alternative: Prefix + n (without Ctrl)
bind-key n run-shell "/home/user/dotfiles/.tmux/core/audio-mode-switcher.sh tmux-cycle"

# Display current audio mode
bind-key M-n run-shell "/home/user/dotfiles/.tmux/core/audio-mode-switcher.sh display"

# ====================================
# Claude Voice Integration (Prefix + v)
# ====================================

# Voice prefix setup
bind-key v switch-client -T claude-voice-prefix

# Basic voice commands
bind-key -T claude-voice-prefix t run-shell "/home/user/dotfiles/.tmux/core/voice-unified.sh test"
bind-key -T claude-voice-prefix v run-shell "/home/user/dotfiles/.tmux/core/voice-unified.sh diagnose"

# Status notifications
bind-key -T claude-voice-prefix 1 run-shell "/home/user/dotfiles/.tmux/core/voice-unified.sh notify 'Status complete' '✅' 1"
bind-key -T claude-voice-prefix 2 run-shell "/home/user/dotfiles/.tmux/core/voice-unified.sh notify 'Status waiting' '⌛' 1" 
bind-key -T claude-voice-prefix 3 run-shell "/home/user/dotfiles/.tmux/core/voice-unified.sh notify 'Status busy' '⚡' 1"

# AI summary modes
bind-key -T claude-voice-prefix b run-shell "/home/user/dotfiles/.tmux/core/voice-unified.sh notify 'Brief summary generated' '✅' 1 'ai'"
bind-key -T claude-voice-prefix d run-shell "/home/user/dotfiles/.tmux/core/voice-unified.sh notify 'Detailed summary generated' '✅' 1 'full'"

# ====================================
# Ollama Integration (Prefix + o) 
# ====================================

# Ollama prefix setup
bind-key o switch-client -T ollama-prefix

# Ollama diagnostics and health
bind-key -T ollama-prefix t run-shell "/home/user/dotfiles/.tmux/core/ollama-cross.sh test"
bind-key -T ollama-prefix h run-shell "/home/user/dotfiles/.tmux/core/ollama-cross.sh health"
bind-key -T ollama-prefix d run-shell "/home/user/dotfiles/.tmux/core/ollama-cross.sh diagnose"
bind-key -T ollama-prefix m run-shell "/home/user/dotfiles/.tmux/core/ollama-cross.sh models"
bind-key -T ollama-prefix u run-shell "/home/user/dotfiles/.tmux/core/ollama-cross.sh url"

# ====================================
# Audio Fallback Testing (Prefix + a)
# ====================================

# Audio testing prefix
bind-key a switch-client -T audio-prefix

# Audio mode testing
bind-key -T audio-prefix t run-shell "/home/user/dotfiles/.tmux/core/audio-fallback.sh test"
bind-key -T audio-prefix d run-shell "/home/user/dotfiles/.tmux/core/audio-fallback.sh diagnose"

# Manual audio tests
bind-key -T audio-prefix 1 run-shell "/home/user/dotfiles/.tmux/core/audio-fallback.sh play '⚡' 'auto' 'Busy test'"
bind-key -T audio-prefix 2 run-shell "/home/user/dotfiles/.tmux/core/audio-fallback.sh play '⌛' 'auto' 'Waiting test'"
bind-key -T audio-prefix 3 run-shell "/home/user/dotfiles/.tmux/core/audio-fallback.sh play '✅' 'auto' 'Success test'"

# Mode-specific tests
bind-key -T audio-prefix s run-shell "/home/user/dotfiles/.tmux/core/audio-fallback.sh audio '✅' 'Audio device test'"
bind-key -T audio-prefix n run-shell "/home/user/dotfiles/.tmux/core/audio-fallback.sh notification '✅' 'System notification test'"
bind-key -T audio-prefix b run-shell "/home/user/dotfiles/.tmux/core/audio-fallback.sh beep '✅'"

# ====================================
# Help and Information (Prefix + ?)
# ====================================

# Help display
bind-key ? run-shell 'echo "
TMux Phase 2 Unified Keybindings:

Audio Mode Switcher:
  Prefix + C-n  - 音声モード切り替え (audio ↔ notification)
  Prefix + n    - 同上 (Ctrl不要)
  Prefix + M-n  - 現在のモード表示

Claude Voice:
  Prefix + v + t - Voice system test
  Prefix + v + 1/2/3 - Status notifications
  Prefix + v + b/d - AI summary modes

Ollama Integration:
  Prefix + o + h - Health check
  Prefix + o + d - Diagnostics
  Prefix + o + m - Available models

Audio Testing:
  Prefix + a + t - Audio system test
  Prefix + a + 1/2/3 - Status audio tests
  Prefix + a + s/n/b - Mode-specific tests

Help:
  Prefix + ? - This help message
"'

# ====================================
# Status Bar Integration
# ====================================

# Display current audio mode in status bar (optional)
# set -g status-right "#(/home/user/dotfiles/.tmux/core/audio-mode-switcher.sh get) | %Y-%m-%d %H:%M"

# ====================================
# Hook Integration
# ====================================

# Session hooks for Claude Voice initialization
set-hook -g session-created 'run-shell "/home/user/dotfiles/.tmux/claude/session-hook.sh"'
set-hook -g client-attached 'run-shell "/home/user/dotfiles/.tmux/core/audio-mode-switcher.sh display"'