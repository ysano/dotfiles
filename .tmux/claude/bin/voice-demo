#!/bin/bash
# Claude Voice - Voice Character Demo
# macOS音声キャラクターのデモンストレーション

# 環境設定
CLAUDE_VOICE_HOME="${CLAUDE_VOICE_HOME:-$HOME/.tmux/claude}"
export CLAUDE_VOICE_HOME

# 日本語音声リスト
JAPANESE_VOICES=(
    "Kyoko"
    "Kyoko (Enhanced)"
    "Otoya"
    "Eddy (日本語（日本）)"
    "Flo (日本語（日本）)"
    "Grandma (日本語（日本）)"
    "Grandpa (日本語（日本）)"
    "Reed (日本語（日本）)"
    "Rocko (日本語（日本）)"
    "Sandy (日本語（日本）)"
    "Shelley (日本語（日本）)"
)

# 英語音声リスト（主要なもの）
ENGLISH_VOICES=(
    "Daniel"      # イギリス英語
    "Kate"        # イギリス英語
    "Samantha"    # アメリカ英語
    "Alex"        # アメリカ英語
    "Fred"        # アメリカ英語
    "Victoria"    # アメリカ英語
    "Albert"      # アメリカ英語
    "Kathy"       # アメリカ英語
)

# 特殊効果音声
SPECIAL_VOICES=(
    "Bells"       # ベル音
    "Boing"       # ボイング音
    "Bubbles"     # バブル音
    "Cellos"      # チェロ音
    "Good News"   # 良いニュース風
    "Bad News"    # 悪いニュース風
    "Whisper"     # ささやき声
    "Wobble"      # ゆらぎ声
    "Jester"      # 道化師風
)

# ヘルプメッセージ
show_help() {
    cat <<EOF
Voice Character Demo - macOS音声キャラクターデモ

使用法: $(basename "$0") [COMMAND] [OPTIONS]

コマンド:
  list [lang]      利用可能な音声を一覧表示
  demo [lang]      音声デモを再生
  test <voice>     特定の音声をテスト
  compare          音声を比較再生
  all              すべての音声でテスト

言語オプション:
  ja, japanese     日本語音声
  en, english      英語音声
  special          特殊効果音声
  all              すべて

例:
  $(basename "$0") list ja         # 日本語音声一覧
  $(basename "$0") demo japanese   # 日本語音声デモ
  $(basename "$0") test Kyoko      # Kyoko音声テスト
  $(basename "$0") compare          # 音声比較
EOF
}

# 音声リスト表示
list_voices() {
    local lang="${1:-all}"
    
    case "$lang" in
        "ja"|"japanese")
            echo "🇯🇵 日本語音声:"
            for voice in "${JAPANESE_VOICES[@]}"; do
                echo "  • $voice"
            done
            ;;
        "en"|"english")
            echo "🇬🇧🇺🇸 英語音声:"
            for voice in "${ENGLISH_VOICES[@]}"; do
                echo "  • $voice"
            done
            ;;
        "special")
            echo "🎭 特殊効果音声:"
            for voice in "${SPECIAL_VOICES[@]}"; do
                echo "  • $voice"
            done
            ;;
        "all")
            list_voices ja
            echo ""
            list_voices en
            echo ""
            list_voices special
            ;;
        *)
            echo "Unknown language: $lang"
            ;;
    esac
}

# 音声デモ再生
play_demo() {
    local lang="${1:-ja}"
    local test_text_ja="こんにちは。私は音声合成システムです。この声はいかがでしょうか。"
    local test_text_en="Hello. I am a text-to-speech system. How does my voice sound?"
    
    case "$lang" in
        "ja"|"japanese")
            echo "🎤 日本語音声デモンストレーション"
            echo "================================"
            for voice in "${JAPANESE_VOICES[@]}"; do
                echo ""
                echo "▶️  $voice"
                say -v "$voice" "$test_text_ja" 2>/dev/null || {
                    echo "   ⚠️  この音声は利用できません"
                }
                sleep 1
            done
            ;;
            
        "en"|"english")
            echo "🎤 English Voice Demonstration"
            echo "=============================="
            for voice in "${ENGLISH_VOICES[@]}"; do
                echo ""
                echo "▶️  $voice"
                say -v "$voice" "$test_text_en" 2>/dev/null || {
                    echo "   ⚠️  This voice is not available"
                }
                sleep 1
            done
            ;;
            
        "special")
            echo "🎭 Special Effect Voices"
            echo "========================"
            local test_text="Testing special voice effects"
            for voice in "${SPECIAL_VOICES[@]}"; do
                echo ""
                echo "▶️  $voice"
                say -v "$voice" "$test_text" 2>/dev/null || {
                    echo "   ⚠️  This voice is not available"
                }
                sleep 1
            done
            ;;
            
        "all")
            play_demo ja
            echo ""
            play_demo en
            echo ""
            play_demo special
            ;;
            
        *)
            echo "Error: Unknown language: $lang"
            ;;
    esac
}

# 特定の音声をテスト
test_voice() {
    local voice_name="$1"
    local custom_text="${2:-}"
    
    if [[ -z "$voice_name" ]]; then
        echo "Error: Voice name required"
        return 1
    fi
    
    echo "🔊 Testing voice: $voice_name"
    
    # 音声が存在するかチェック
    if ! say -v '?' | grep -q "^$voice_name "; then
        echo "❌ Voice '$voice_name' not found"
        echo ""
        echo "Available voices containing '$voice_name':"
        say -v '?' | grep -i "$voice_name" | head -10
        return 1
    fi
    
    # 言語を自動判定
    local lang_code=$(say -v '?' | grep "^$voice_name " | awk '{print $2}')
    local test_text
    
    if [[ "$lang_code" == "ja_JP" ]]; then
        test_text="${custom_text:-こんにちは。$voice_name の音声テストです。本日は良い天気ですね。}"
    else
        test_text="${custom_text:-Hello. This is a voice test for $voice_name. It is a beautiful day today.}"
    fi
    
    echo "Language: $lang_code"
    echo "Text: $test_text"
    echo ""
    
    # 通常速度
    echo "▶️  Normal speed (200 wpm)"
    say -v "$voice_name" -r 200 "$test_text"
    sleep 1
    
    # 速い
    echo "▶️  Fast speed (300 wpm)"
    say -v "$voice_name" -r 300 "$test_text"
    sleep 1
    
    # 遅い
    echo "▶️  Slow speed (150 wpm)"
    say -v "$voice_name" -r 150 "$test_text"
}

# 音声比較
compare_voices() {
    echo "🎭 Voice Comparison Mode"
    echo "========================"
    echo ""
    
    local test_text_ja="音声を比較しています"
    local test_text_en="Comparing voices"
    
    # 日本語音声比較
    echo "🇯🇵 Japanese voices:"
    for voice in "Kyoko" "Otoya" "Kyoko (Enhanced)"; do
        echo "  $voice: "
        say -v "$voice" "$test_text_ja" 2>/dev/null
        sleep 0.5
    done
    
    echo ""
    echo "🇬🇧🇺🇸 English voices:"
    for voice in "Daniel" "Samantha" "Alex"; do
        echo "  $voice: "
        say -v "$voice" "$test_text_en" 2>/dev/null
        sleep 0.5
    done
}

# インタラクティブモード
interactive_mode() {
    echo "🎙️ Interactive Voice Test Mode"
    echo "=============================="
    echo ""
    
    while true; do
        echo "Available commands:"
        echo "  1) List Japanese voices"
        echo "  2) List English voices"
        echo "  3) Play Japanese demo"
        echo "  4) Play English demo"
        echo "  5) Test specific voice"
        echo "  6) Compare voices"
        echo "  q) Quit"
        echo ""
        echo -n "Select option: "
        read -r option
        
        case "$option" in
            1) list_voices ja ;;
            2) list_voices en ;;
            3) play_demo ja ;;
            4) play_demo en ;;
            5)
                echo -n "Enter voice name: "
                read -r voice_name
                test_voice "$voice_name"
                ;;
            6) compare_voices ;;
            q|Q) 
                echo "Goodbye!"
                break
                ;;
            *)
                echo "Invalid option"
                ;;
        esac
        
        echo ""
        echo "Press Enter to continue..."
        read -r
        clear
    done
}

# メイン処理
main() {
    local command="${1:-help}"
    shift
    
    case "$command" in
        "list")
            list_voices "$@"
            ;;
        "demo")
            play_demo "$@"
            ;;
        "test")
            test_voice "$@"
            ;;
        "compare")
            compare_voices
            ;;
        "interactive"|"i")
            interactive_mode
            ;;
        "all")
            play_demo all
            ;;
        "help"|"--help"|"-h")
            show_help
            ;;
        *)
            echo "Error: Unknown command: $command"
            echo ""
            show_help
            exit 1
            ;;
    esac
}

# スクリプト実行
if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
    main "$@"
fi