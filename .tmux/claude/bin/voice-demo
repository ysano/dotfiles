#!/bin/bash
# Claude Voice - Voice Character Demo
# macOSéŸ³å£°ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

# ç’°å¢ƒè¨­å®š
CLAUDE_VOICE_HOME="${CLAUDE_VOICE_HOME:-$HOME/.tmux/claude}"
export CLAUDE_VOICE_HOME

# æ—¥æœ¬èªéŸ³å£°ãƒªã‚¹ãƒˆ
JAPANESE_VOICES=(
    "Kyoko"
    "Kyoko (Enhanced)"
    "Otoya"
    "Eddy (æ—¥æœ¬èªï¼ˆæ—¥æœ¬ï¼‰)"
    "Flo (æ—¥æœ¬èªï¼ˆæ—¥æœ¬ï¼‰)"
    "Grandma (æ—¥æœ¬èªï¼ˆæ—¥æœ¬ï¼‰)"
    "Grandpa (æ—¥æœ¬èªï¼ˆæ—¥æœ¬ï¼‰)"
    "Reed (æ—¥æœ¬èªï¼ˆæ—¥æœ¬ï¼‰)"
    "Rocko (æ—¥æœ¬èªï¼ˆæ—¥æœ¬ï¼‰)"
    "Sandy (æ—¥æœ¬èªï¼ˆæ—¥æœ¬ï¼‰)"
    "Shelley (æ—¥æœ¬èªï¼ˆæ—¥æœ¬ï¼‰)"
)

# è‹±èªéŸ³å£°ãƒªã‚¹ãƒˆï¼ˆä¸»è¦ãªã‚‚ã®ï¼‰
ENGLISH_VOICES=(
    "Daniel"      # ã‚¤ã‚®ãƒªã‚¹è‹±èª
    "Kate"        # ã‚¤ã‚®ãƒªã‚¹è‹±èª
    "Samantha"    # ã‚¢ãƒ¡ãƒªã‚«è‹±èª
    "Alex"        # ã‚¢ãƒ¡ãƒªã‚«è‹±èª
    "Fred"        # ã‚¢ãƒ¡ãƒªã‚«è‹±èª
    "Victoria"    # ã‚¢ãƒ¡ãƒªã‚«è‹±èª
    "Albert"      # ã‚¢ãƒ¡ãƒªã‚«è‹±èª
    "Kathy"       # ã‚¢ãƒ¡ãƒªã‚«è‹±èª
)

# ç‰¹æ®ŠåŠ¹æœéŸ³å£°
SPECIAL_VOICES=(
    "Bells"       # ãƒ™ãƒ«éŸ³
    "Boing"       # ãƒœã‚¤ãƒ³ã‚°éŸ³
    "Bubbles"     # ãƒãƒ–ãƒ«éŸ³
    "Cellos"      # ãƒã‚§ãƒ­éŸ³
    "Good News"   # è‰¯ã„ãƒ‹ãƒ¥ãƒ¼ã‚¹é¢¨
    "Bad News"    # æ‚ªã„ãƒ‹ãƒ¥ãƒ¼ã‚¹é¢¨
    "Whisper"     # ã•ã•ã‚„ãå£°
    "Wobble"      # ã‚†ã‚‰ãå£°
    "Jester"      # é“åŒ–å¸«é¢¨
)

# ãƒ˜ãƒ«ãƒ—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
show_help() {
    cat <<EOF
Voice Character Demo - macOSéŸ³å£°ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ‡ãƒ¢

ä½¿ç”¨æ³•: $(basename "$0") [COMMAND] [OPTIONS]

ã‚³ãƒãƒ³ãƒ‰:
  list [lang]      åˆ©ç”¨å¯èƒ½ãªéŸ³å£°ã‚’ä¸€è¦§è¡¨ç¤º
  demo [lang]      éŸ³å£°ãƒ‡ãƒ¢ã‚’å†ç”Ÿ
  test <voice>     ç‰¹å®šã®éŸ³å£°ã‚’ãƒ†ã‚¹ãƒˆ
  compare          éŸ³å£°ã‚’æ¯”è¼ƒå†ç”Ÿ
  all              ã™ã¹ã¦ã®éŸ³å£°ã§ãƒ†ã‚¹ãƒˆ

è¨€èªã‚ªãƒ—ã‚·ãƒ§ãƒ³:
  ja, japanese     æ—¥æœ¬èªéŸ³å£°
  en, english      è‹±èªéŸ³å£°
  special          ç‰¹æ®ŠåŠ¹æœéŸ³å£°
  all              ã™ã¹ã¦

ä¾‹:
  $(basename "$0") list ja         # æ—¥æœ¬èªéŸ³å£°ä¸€è¦§
  $(basename "$0") demo japanese   # æ—¥æœ¬èªéŸ³å£°ãƒ‡ãƒ¢
  $(basename "$0") test Kyoko      # KyokoéŸ³å£°ãƒ†ã‚¹ãƒˆ
  $(basename "$0") compare          # éŸ³å£°æ¯”è¼ƒ
EOF
}

# éŸ³å£°ãƒªã‚¹ãƒˆè¡¨ç¤º
list_voices() {
    local lang="${1:-all}"
    
    case "$lang" in
        "ja"|"japanese")
            echo "ğŸ‡¯ğŸ‡µ æ—¥æœ¬èªéŸ³å£°:"
            for voice in "${JAPANESE_VOICES[@]}"; do
                echo "  â€¢ $voice"
            done
            ;;
        "en"|"english")
            echo "ğŸ‡¬ğŸ‡§ğŸ‡ºğŸ‡¸ è‹±èªéŸ³å£°:"
            for voice in "${ENGLISH_VOICES[@]}"; do
                echo "  â€¢ $voice"
            done
            ;;
        "special")
            echo "ğŸ­ ç‰¹æ®ŠåŠ¹æœéŸ³å£°:"
            for voice in "${SPECIAL_VOICES[@]}"; do
                echo "  â€¢ $voice"
            done
            ;;
        "all")
            list_voices ja
            echo ""
            list_voices en
            echo ""
            list_voices special
            ;;
        *)
            echo "Unknown language: $lang"
            ;;
    esac
}

# éŸ³å£°ãƒ‡ãƒ¢å†ç”Ÿ
play_demo() {
    local lang="${1:-ja}"
    local test_text_ja="ã“ã‚“ã«ã¡ã¯ã€‚ç§ã¯éŸ³å£°åˆæˆã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚ã“ã®å£°ã¯ã„ã‹ãŒã§ã—ã‚‡ã†ã‹ã€‚"
    local test_text_en="Hello. I am a text-to-speech system. How does my voice sound?"
    
    case "$lang" in
        "ja"|"japanese")
            echo "ğŸ¤ æ—¥æœ¬èªéŸ³å£°ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³"
            echo "================================"
            for voice in "${JAPANESE_VOICES[@]}"; do
                echo ""
                echo "â–¶ï¸  $voice"
                say -v "$voice" "$test_text_ja" 2>/dev/null || {
                    echo "   âš ï¸  ã“ã®éŸ³å£°ã¯åˆ©ç”¨ã§ãã¾ã›ã‚“"
                }
                sleep 1
            done
            ;;
            
        "en"|"english")
            echo "ğŸ¤ English Voice Demonstration"
            echo "=============================="
            for voice in "${ENGLISH_VOICES[@]}"; do
                echo ""
                echo "â–¶ï¸  $voice"
                say -v "$voice" "$test_text_en" 2>/dev/null || {
                    echo "   âš ï¸  This voice is not available"
                }
                sleep 1
            done
            ;;
            
        "special")
            echo "ğŸ­ Special Effect Voices"
            echo "========================"
            local test_text="Testing special voice effects"
            for voice in "${SPECIAL_VOICES[@]}"; do
                echo ""
                echo "â–¶ï¸  $voice"
                say -v "$voice" "$test_text" 2>/dev/null || {
                    echo "   âš ï¸  This voice is not available"
                }
                sleep 1
            done
            ;;
            
        "all")
            play_demo ja
            echo ""
            play_demo en
            echo ""
            play_demo special
            ;;
            
        *)
            echo "Error: Unknown language: $lang"
            ;;
    esac
}

# ç‰¹å®šã®éŸ³å£°ã‚’ãƒ†ã‚¹ãƒˆ
test_voice() {
    local voice_name="$1"
    local custom_text="${2:-}"
    
    if [[ -z "$voice_name" ]]; then
        echo "Error: Voice name required"
        return 1
    fi
    
    echo "ğŸ”Š Testing voice: $voice_name"
    
    # éŸ³å£°ãŒå­˜åœ¨ã™ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
    if ! say -v '?' | grep -q "^$voice_name "; then
        echo "âŒ Voice '$voice_name' not found"
        echo ""
        echo "Available voices containing '$voice_name':"
        say -v '?' | grep -i "$voice_name" | head -10
        return 1
    fi
    
    # è¨€èªã‚’è‡ªå‹•åˆ¤å®š
    local lang_code=$(say -v '?' | grep "^$voice_name " | awk '{print $2}')
    local test_text
    
    if [[ "$lang_code" == "ja_JP" ]]; then
        test_text="${custom_text:-ã“ã‚“ã«ã¡ã¯ã€‚$voice_name ã®éŸ³å£°ãƒ†ã‚¹ãƒˆã§ã™ã€‚æœ¬æ—¥ã¯è‰¯ã„å¤©æ°—ã§ã™ã­ã€‚}"
    else
        test_text="${custom_text:-Hello. This is a voice test for $voice_name. It is a beautiful day today.}"
    fi
    
    echo "Language: $lang_code"
    echo "Text: $test_text"
    echo ""
    
    # é€šå¸¸é€Ÿåº¦
    echo "â–¶ï¸  Normal speed (200 wpm)"
    say -v "$voice_name" -r 200 "$test_text"
    sleep 1
    
    # é€Ÿã„
    echo "â–¶ï¸  Fast speed (300 wpm)"
    say -v "$voice_name" -r 300 "$test_text"
    sleep 1
    
    # é…ã„
    echo "â–¶ï¸  Slow speed (150 wpm)"
    say -v "$voice_name" -r 150 "$test_text"
}

# éŸ³å£°æ¯”è¼ƒ
compare_voices() {
    echo "ğŸ­ Voice Comparison Mode"
    echo "========================"
    echo ""
    
    local test_text_ja="éŸ³å£°ã‚’æ¯”è¼ƒã—ã¦ã„ã¾ã™"
    local test_text_en="Comparing voices"
    
    # æ—¥æœ¬èªéŸ³å£°æ¯”è¼ƒ
    echo "ğŸ‡¯ğŸ‡µ Japanese voices:"
    for voice in "Kyoko" "Otoya" "Kyoko (Enhanced)"; do
        echo "  $voice: "
        say -v "$voice" "$test_text_ja" 2>/dev/null
        sleep 0.5
    done
    
    echo ""
    echo "ğŸ‡¬ğŸ‡§ğŸ‡ºğŸ‡¸ English voices:"
    for voice in "Daniel" "Samantha" "Alex"; do
        echo "  $voice: "
        say -v "$voice" "$test_text_en" 2>/dev/null
        sleep 0.5
    done
}

# ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ¢ãƒ¼ãƒ‰
interactive_mode() {
    echo "ğŸ™ï¸ Interactive Voice Test Mode"
    echo "=============================="
    echo ""
    
    while true; do
        echo "Available commands:"
        echo "  1) List Japanese voices"
        echo "  2) List English voices"
        echo "  3) Play Japanese demo"
        echo "  4) Play English demo"
        echo "  5) Test specific voice"
        echo "  6) Compare voices"
        echo "  q) Quit"
        echo ""
        echo -n "Select option: "
        read -r option
        
        case "$option" in
            1) list_voices ja ;;
            2) list_voices en ;;
            3) play_demo ja ;;
            4) play_demo en ;;
            5)
                echo -n "Enter voice name: "
                read -r voice_name
                test_voice "$voice_name"
                ;;
            6) compare_voices ;;
            q|Q) 
                echo "Goodbye!"
                break
                ;;
            *)
                echo "Invalid option"
                ;;
        esac
        
        echo ""
        echo "Press Enter to continue..."
        read -r
        clear
    done
}

# ãƒ¡ã‚¤ãƒ³å‡¦ç†
main() {
    local command="${1:-help}"
    shift
    
    case "$command" in
        "list")
            list_voices "$@"
            ;;
        "demo")
            play_demo "$@"
            ;;
        "test")
            test_voice "$@"
            ;;
        "compare")
            compare_voices
            ;;
        "interactive"|"i")
            interactive_mode
            ;;
        "all")
            play_demo all
            ;;
        "help"|"--help"|"-h")
            show_help
            ;;
        *)
            echo "Error: Unknown command: $command"
            echo ""
            show_help
            exit 1
            ;;
    esac
}

# ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ
if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
    main "$@"
fi